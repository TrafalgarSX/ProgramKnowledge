### Generator expressions
---
Generator expression which was introduced in CMake 3.15.

[`GeneratorÂ expressions`](https://cmake.org/cmake/help/v3.25/manual/cmake-generator-expressions.7.html#manual:cmake-generator-expressions(7) "cmake-generator-expressions(7)")Â are evaluated during build system generation to produce information **specific to each build configuration**.

è¿™ä¸ªå¯¹äºvisual studio, xcode è¿™ç§multi-configuration generatorså¾ˆæœ‰ç”¨ï¼Œ å› ä¸ºä»–ä»¬çš„Debug Releaseç±»å‹éƒ½æ˜¯ç¼–è¯‘çš„æ—¶å€™ç¡®å®šçš„ï¼ˆ`cmake --build . --cofnig Debug|Release`)ï¼Œè¿™æ ·Generator expression å°±å¯ä»¥ â€œproduce  information specific to each build configurationâ€

[`GeneratorÂ expressions`](https://cmake.org/cmake/help/v3.25/manual/cmake-generator-expressions.7.html#manual:cmake-generator-expressions(7) "cmake-generator-expressions(7)")Â are allowed in the context of many target properties, such as
- [`LINK_LIBRARIES`](https://cmake.org/cmake/help/v3.25/prop_tgt/LINK_LIBRARIES.html#prop_tgt:LINK_LIBRARIES "LINK_LIBRARIES"),Â 
- [`INCLUDE_DIRECTORIES`](https://cmake.org/cmake/help/v3.25/prop_tgt/INCLUDE_DIRECTORIES.html#prop_tgt:INCLUDE_DIRECTORIES "INCLUDE_DIRECTORIES"),Â 
- [`COMPILE_DEFINITIONS`](https://cmake.org/cmake/help/v3.25/prop_tgt/COMPILE_DEFINITIONS.html#prop_tgt:COMPILE_DEFINITIONS "COMPILE_DEFINITIONS")
- and others. 

They may also be used when using commands to populate those properties, such asÂ 
- [`target_link_libraries()`](https://cmake.org/cmake/help/v3.25/command/target_link_libraries.html#command:target_link_libraries "target_link_libraries"),
- [`target_include_directories()`](https://cmake.org/cmake/help/v3.25/command/target_include_directories.html#command:target_include_directories "target_include_directories"),
- [`target_compile_definitions()`](https://cmake.org/cmake/help/v3.25/command/target_compile_definitions.html#command:target_compile_definitions "target_compile_definitions")Â 
- and others.(å…¶å®å’Œä¸Šé¢ä¸€ä¸€å¯¹åº”)

Generator expressions may be used to 
- enable **conditional linking**, 
- **conditional definitions** used when compiling, 
- **conditional include directories** and more. 

ğŸ’¡è¿˜æ˜¯å’Œä¸Šé¢ä¸€ä¸€å¯¹åº”
The conditions may be based on the build configuration, target properties, platform information or any other queryable information.

There are different types ofÂ [`generatorÂ expressions`](https://cmake.org/cmake/help/v3.25/manual/cmake-generator-expressions.7.html#manual:cmake-generator-expressions(7) "cmake-generator-expressions(7)")Â including 
- Logical
- Informational
- Output expressions.

ğŸ’¡**Logical expressions** are used to create conditional output. The basic expressions are the 0 and 1 expressions. A $<0:...> results in the empty string, and <1:...> results in the content of .... They can also be nested.
**é‡ä¸­ä¹‹é‡ï¼Œè¦ç†è§£ç”Ÿæˆè¡¨è¾¾å¼çš„ä½œç”¨å°±å…ˆç†è§£ä¸Šé¢è¿™æ®µè¯**

#### Adding Compiler Warning Flags with Generator Expressions
A common usage of generator expressions is to **conditionally add compiler flags, such as those for language levels or warnings.** A nice pattern is to associate this information to an `INTERFACE` target allowing this information to propagate.

```cmake 
# TODO 4: Update the minimum required version to 3.15

cmake_minimum_required(VERSION 3.15)

# set the project name and version
project(Tutorial VERSION 1.0)

# TODO 1: Replace the following code by:
# * Creating an interface library called tutorial_compiler_flags
#   Hint: use add_library() with the INTERFACE signature
# * Add compiler feature cxx_std_11 to tutorial_compiler_flags
#   Hint: Use target_compile_features()

# specify the C++ standard
add_library(tutorial_compiler_flags INTERFACE)
target_compile_features(tutorial_compiler_flags INTERFACE cxx_std_11)

# TODO 5: Create helper variables to determine which compiler we are using:
# * Create a new variable gcc_like_cxx that is true if we are using CXX and
#   any of the following compilers: ARMClang, AppleClang, Clang, GNU, LCC
# * Create a new variable msvc_cxx that is true if we are using CXX and MSVC
# Hint: Use set() and COMPILE_LANG_AND_ID
set(msvc_cxx "$<COMPILE_LANG_AND_ID:CXX,MSVC>")
set(gcc_like_cxx "$<COMPILE_LANG_AND_ID:CXX,ARMClang,AppleClang,Clang,GNU,LCC>")

# TODO 6: Add warning flag compile options to the interface library
# tutorial_compiler_flags.
# * For gcc_like_cxx, add flags -Wall;-Wextra;-Wshadow;-Wformat=2;-Wunused
# * For msvc_cxx, add flags -W3
# Hint: Use target_compile_options()
target_compile_options(tutorial_compiler_flags INTERFACE
  "$<${gcc_like_cxx}:$<BUILD_INTERFACE:-Wall;-Wextra;-Wshadow;-Wformat=2;-Wunused>>"
  "$<${msvc_cxx}:$<BUILD_INTERFACE:-W3>>"
  )

# TODO 7: With nested generator expressions, only use the flags for the
# build-tree
# Hint: Use BUILD_INTERFACE
target_compile_options(tutorial_compiler_flags INTERFACE
  "$<${gcc_like_cxx}:$<BUILD_INTERFACE:-Wall;-Wextra;-Wshadow;-Wformat=2;-Wunused>>"
  "$<${msvc_cxx}:$<BUILD_INTERFACE:-W3>>"
)

# should we use our own math functions
option(USE_MYMATH "Use tutorial provided math implementation" ON)

# configure a header file to pass some of the CMake settings
# to the source code
configure_file(TutorialConfig.h.in TutorialConfig.h)

# add the MathFunctions library
if(USE_MYMATH)
  add_subdirectory(MathFunctions)
  list(APPEND EXTRA_LIBS MathFunctions)
endif()

# add the executable
add_executable(Tutorial tutorial.cxx)

# TODO 2: Link to tutorial_compiler_flags

target_link_libraries(Tutorial PUBLIC ${EXTRA_LIBS} tutorial_compiler_flags)

# add the binary tree to the search path for include files
# so that we will find TutorialConfig.h
target_include_directories(Tutorial PUBLIC
                           "${PROJECT_BINARY_DIR}"
                           )
```

### æ¦‚è¿°
---
ç”Ÿæˆå™¨è¡¨è¾¾å¼ç®€å•æ¥è¯´å°±æ˜¯**åœ¨CMakeç”Ÿæˆæ„å»ºç³»ç»Ÿçš„æ—¶å€™æ ¹æ®ä¸åŒé…ç½®åŠ¨æ€ç”Ÿæˆç‰¹å®šçš„å†…å®¹**ã€‚æ¯”å¦‚ï¼š

1. æ¡ä»¶é“¾æ¥ï¼Œå¦‚é’ˆå¯¹åŒä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œdebugç‰ˆæœ¬å’Œreleaseç‰ˆæœ¬é“¾æ¥ä¸åŒçš„åº“æ–‡ä»¶
2. æ¡ä»¶å®šä¹‰ï¼Œå¦‚é’ˆå¯¹ä¸åŒç¼–è¯‘å™¨ï¼Œå®šä¹‰ä¸åŒçš„å®

ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„æ ¼å¼å½¢å¦‚`$<...>`ï¼Œå¯ä»¥åµŒå¥—ï¼Œå¯ä»¥ç”¨åœ¨å¾ˆå¤šæ„å»ºç›®æ ‡çš„å±æ€§è®¾ç½®å’Œç‰¹å®šçš„CMakeå‘½ä»¤ä¸­ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œç”Ÿæˆè¡¨è¾¾å¼è¢«å±•å¼€æ˜¯åœ¨ç”Ÿæˆæ„å»ºç³»ç»Ÿçš„æ—¶å€™ï¼Œæ‰€ä»¥**ä¸èƒ½é€šè¿‡è§£æé…ç½®CMakeLists.txté˜¶æ®µçš„`message`å‘½ä»¤æ‰“å°**ï¼Œæ–‡æœ«ä¼šä»‹ç»å…¶è°ƒè¯•æ–¹æ³•ã€‚


### å¸¸ç”¨çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼
---
#### å¸ƒå°”ç”Ÿæˆå™¨è¡¨è¾¾å¼

##### é€»è¾‘è¿ç®—ç¬¦

é€»è¾‘è¿ç®—å¾ˆå¤šè¯­è¨€éƒ½æ˜¯éœ€è¦çš„ï¼ŒCMakeç”Ÿæˆå™¨è¡¨è¾¾å¼ä¸­æœ‰è¿™äº›ï¼š

1. `$<BOOL:string>`ï¼šå¦‚æœå­—ç¬¦ä¸²ä¸ºç©ºã€`0`ï¼›ä¸åŒºåˆ†å¤§å°å†™çš„`FALSE`ã€`OFF`ã€`N`ã€`NO`ã€`IGNORE`ã€`NOTFOUND`ï¼›æˆ–è€…åŒºåˆ†å¤§å°å†™ä»¥`-NOTFOUND`ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œåˆ™ä¸º0ï¼Œå¦åˆ™ä¸º1
2. `$<AND:conditions>`ï¼šé€»è¾‘ä¸ï¼Œ`conditons`æ˜¯ä»¥**é€—å·åˆ†å‰²çš„æ¡ä»¶åˆ—è¡¨**
3. `$<OR:conditions>`ï¼šé€»è¾‘æˆ–ï¼Œ`conditons`æ˜¯ä»¥é€—å·åˆ†å‰²çš„æ¡ä»¶åˆ—è¡¨
4. `$<NOT:condition>`ï¼šé€»è¾‘é

> ä¸€èˆ¬æ¥è¯´ï¼Œæ¡ä»¶æ˜¯åˆ—è¡¨çš„ï¼Œéƒ½æ˜¯ä½¿ç”¨é€—å·è¿›è¡Œåˆ†å‰²ï¼Œåé¢ä¸å†èµ˜è¿°ã€‚

##### å­—ç¬¦ä¸²æ¯”è¾ƒ
1. `$<STREQUAL:string1,string2>`ï¼šåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰
2. `$<EQUAL:value1,value2>`ï¼šåˆ¤æ–­æ•°å€¼æ˜¯å¦ç›¸ç­‰
3. `$<IN_LIST:string,list>`ï¼šåˆ¤æ–­`string`æ˜¯å¦åŒ…å«åœ¨`list`ä¸­ï¼Œ`list`ä½¿ç”¨**åˆ†å·åˆ†å‰²**

> æ³¨æ„è¿™é‡Œçš„`list`æ˜¯åœ¨é€—å·åé¢çš„åˆ—è¡¨ï¼Œæ‰€ä»¥å…¶å†…å®¹éœ€è¦ä½¿ç”¨åˆ†å·åˆ†å‰²ã€‚

##### å˜é‡æŸ¥è¯¢

è¿™ä¸ªä¼šæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œåœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ä¼šæ ¹æ®ä¸åŒCMakeå†…ç½®å˜é‡ç”Ÿæˆä¸åŒé…ç½®ï¼Œæ ¸å¿ƒå°±åœ¨äºâ€œåˆ¤æ–­â€ï¼š

1. `$<TARGET_EXISTS:target>`ï¼šåˆ¤æ–­ç›®æ ‡æ˜¯å¦å­˜åœ¨
2. `$<CONFIG:cfgs>`ï¼šåˆ¤æ–­ç¼–è¯‘ç±»å‹é…ç½®æ˜¯å¦åŒ…å«åœ¨`cfgs`åˆ—è¡¨ï¼ˆæ¯”å¦‚"release,debug"ï¼‰ä¸­ï¼›ä¸åŒºåˆ†å¤§å°å†™
3. `$<PLATFORM_ID:platform_ids>`ï¼šåˆ¤æ–­CMakeå®šä¹‰çš„å¹³å°IDæ˜¯å¦åŒ…å«åœ¨`platform_ids`åˆ—è¡¨ä¸­
4. `$<COMPILE_LANGUAGE:languages>`ï¼šåˆ¤æ–­ç¼–è¯‘è¯­è¨€æ˜¯å¦åŒ…å«åœ¨`languages`åˆ—è¡¨ä¸­

#### å­—ç¬¦ä¸²å€¼ç”Ÿæˆå™¨è¡¨è¾¾å¼

è¯·æ³¨æ„ï¼Œå‰é¢éƒ½æ˜¯é“ºå«ï¼Œè¿™é‡Œæ‰æ˜¯ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„**ä¸»è¦ç›®çš„**ï¼š**ç”Ÿæˆç‰¹å®šçš„å­—ç¬¦ä¸²**ã€‚ æ¯”å¦‚å®˜æ–¹çš„ä¾‹å­ï¼šåŸºäºç¼–è¯‘å™¨IDæŒ‡å®šincludeç›®å½•ï¼š

```text
include_directories(/usr/include/$<CXX_COMPILER_ID>/)
```

æ ¹æ®ç¼–è¯‘å™¨çš„ç±»å‹ï¼Œ`$<CXX_COMPILER_ID>`ä¼šè¢«æ›¿æ¢æˆå¯¹åº”çš„IDï¼ˆæ¯”å¦‚â€œGNUâ€ã€â€œClangâ€ï¼‰ã€‚

##### æ¡ä»¶è¡¨è¾¾å¼

è¿™ä¾¿æ˜¯æœ¬æ–‡çš„æ ¸å¿ƒäº†ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ ¼å¼ï¼š

1. `$<condition:true_string>`ï¼šå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™ç»“æœä¸º`true_string`ï¼Œå¦åˆ™ä¸ºç©º
2. `$<IF:condition,str1,str2>`ï¼šå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™ç»“æœä¸º`str1`ï¼Œå¦åˆ™ä¸º`str2`

è¿™é‡Œçš„æ¡ä»¶ä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯å‰é¢ä»‹ç»çš„**å¸ƒå°”ç”Ÿæˆå™¨è¡¨è¾¾å¼**ã€‚ æ¯”å¦‚è¦æ ¹æ®ç¼–è¯‘ç±»å‹æŒ‡å®šä¸åŒçš„ç¼–è¯‘é€‰é¡¹ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š

```text
set(CMAKE_C_FLAGS_DEBUG "${CMAKE_C_FLAGS_DEBUG} -g -O0")
set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} -g -O0")
set(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} -O2")
set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} -O2")
```

ä½†æ˜¯ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼å¯ä»¥ç®€åŒ–æˆï¼š

```text
add_compile_options("$<$<CONFIG:Debug>:-g;-O0>")
add_compile_options($<$<CONFIG:Release>:-O2>)
```

> å¦‚æœéœ€è¦æŒ‡å®šå¤šä¸ªç¼–è¯‘é€‰é¡¹ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æŠŠç”Ÿæˆå™¨è¡¨è¾¾å¼åŒ…å«èµ·æ¥ï¼Œä¸”é€‰é¡¹ä¹‹é—´ä½¿ç”¨åˆ†å·ã€‚

åé¢è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºè®¾ç½®ä¸€äº›å¯¹æ‰€æœ‰ç¼–è¯‘å™¨ï¼ˆå–å†³äºé¡¹ç›®ç¼–è¯‘è¯­è¨€ï¼‰éƒ½é€šç”¨çš„ç¼–è¯‘é€‰é¡¹ï¼Œè€Œéœ€è¦è®¾ç½®ä¸€äº›ç¼–è¯‘å™¨ç‰¹æœ‰çš„é€‰é¡¹æ—¶ï¼Œé€šè¿‡è®¾ç½®æŒ‡å®šç¼–è¯‘å™¨çš„ç¼–è¯‘é€‰é¡¹ï¼ˆå‰ä¸€ç§æ–¹æ³•ï¼‰æ›´åŠ ç®€æ´æ˜äº†ã€‚

> å½“ç„¶ï¼Œå¯ä»¥ç”¨è¡¨è¾¾å¼åˆ¤æ–­ç¼–è¯‘å™¨IDè®¾ç½®ä¸åŒç¼–è¯‘é€‰é¡¹ï¼Œä¸è¿‡æ˜æ˜¾æœ‰äº›ä¸ºäº†ç”¨è€Œç”¨ï¼Œè¿™æ˜¯æ²¡å¿…è¦çš„ã€‚

##### è½¬ä¹‰å­—ç¬¦

è¿™æ¯”è¾ƒå¥½ç†è§£ï¼Œå› ä¸ºæœ‰ä¸€äº›å­—ç¬¦æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦è½¬ä¹‰ï¼Œæ¯”å¦‚å¸¸ç”¨çš„`$<COMMA>`å’Œ`$<SEMICOLON>`ï¼Œåˆ†åˆ«è¡¨ç¤º`,`å’Œ`;`ã€‚

##### å­—ç¬¦ä¸²æ“ä½œ

å¸¸ç”¨çš„æœ‰`$<LOWER_CASE:string>`ã€`$<UPPER_CASE:string>`ç”¨äºè½¬æ¢å¤§å°å†™ã€‚

##### è·å–å˜é‡å€¼

è·å–å˜é‡çš„å€¼å’Œå‰æ–‡æåˆ°çš„å˜é‡æŸ¥è¯¢å¾ˆç±»ä¼¼ï¼Œå‰é¢è¯´çš„å˜é‡æŸ¥è¯¢æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨äºæŒ‡å®šåˆ—è¡¨ä¸­æˆ–è€…ç­‰äºæŒ‡å®šå€¼ã€‚è¯­æ³•æ ¼å¼æ˜¯ç±»ä¼¼çš„ï¼Œä»¥`CONFIG`ä¸ºä¾‹ï¼š

1. è·å–å˜é‡å€¼ï¼š`$<CONFIG>`
2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­ï¼š`$<CONFIG:cfgs>`

##### ç¼–è¯‘ç›®æ ‡æŸ¥è¯¢

è¿™é‡Œçš„æŸ¥è¯¢æ˜¯æŒ‡è·å–ç¼–è¯‘ç›®æ ‡ï¼ˆé€šè¿‡`add_executable()`ã€`add_library()`å‘½ä»¤ç”Ÿæˆçš„ï¼‰ç›¸å…³çš„ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

1. `$<TARGET_FILE:tgt>`ï¼šè·å–ç¼–è¯‘ç›®æ ‡çš„æ–‡ä»¶è·¯å¾„
2. `$<TARGET_FILE_NAME:tgt>`ï¼šè·å–ç¼–è¯‘ç›®æ ‡çš„æ–‡ä»¶å
3. `$<TARGET_FILE_BASE_NAME:tgt>`ï¼šè·å–ç¼–è¯‘ç›®æ ‡çš„åŸºç¡€åå­—ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åå»æ‰å‰ç¼€å’Œæ‰©å±•å

å®˜ç½‘æœ‰æ›´å¤šè¯¦ç»†ä»‹ç»ï¼Œæœ‰å…¶ä»–éœ€è¦å¯ä»¥é˜…è¯»ï¼š**[target-dependent-queries](https://link.zhihu.com/?target=https%3A//cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html%23target-dependent-queries)**ã€‚

### è°ƒè¯•
---
è°ƒè¯•å¯ä»¥é€šè¿‡è¾“å‡ºåˆ°æ–‡ä»¶çš„æ–¹å¼ï¼Œåœ¨`cmake`æ‰§è¡Œå®Œä¹‹åå»æ£€æŸ¥æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ¯”å¦‚ï¼š

```cmake
file(GENERATE OUTPUT "./generator_test.txt" CONTENT "$<$<CONFIG:Debug>:-g;-O0>,$<PLATFORM_ID>\n")
```

åœ¨MacOSä¸­æ‰§è¡Œ`cmake`ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š

```cmake
# cmake -B cmake-build -DCMAKE_BUILD_TYPE=Debug
...
# cat cmake-build/generator_test.txt
-g;-O0,Darwin
```

å¦‚æœä¸æƒ³å†™æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰ç›®æ ‡ï¼Œæ¯”å¦‚ï¼š

```cmake
add_custom_target(gentest COMMAND ${CMAKE_COMMAND} -E echo "\"$<$<CONFIG:Debug>:-g;-O0>,$<PLATFORM_ID>\"")
```

> æ³¨æ„è¿™é‡Œéœ€è¦åŒå¼•å·è½¬ä¹‰ï¼Œç¡®ä¿ç”Ÿæˆå™¨è¡¨è¾¾å¼å±•å¼€ä¹‹åæ˜¯å­—ç¬¦ä¸²ã€‚

åœ¨æ‰§è¡Œ`cmake`ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨`make gentest`è¾“å‡ºåˆ°ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„å†…å®¹ï¼š

```text
# cd cmake-build && make gentest
-g;-O0,Darwin
Built target gentest
```
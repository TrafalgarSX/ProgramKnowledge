### BLOB TREE COMMIT的组成与关系
![[Git分支#分支操作的对象]]

这就是git快照系统的本质：文本有修改 --> 生成新的BLOB对象（与之前的BLOB对象有不同的hash值）--> 生成新的TREE对象，目录中引用新的BLOB对象（hash改变），和内容不变的BLOB对象（相同的对象，hash值不变） --> 生成新的COMMIT对象  -->   新的提交
![[Pasted image 20230327001341.png]]

由于这次 **提交（COMMIT）** 不是第一次 **提交（COMMIT）**，所以它有一个父节点——**commit A1337**。

### Git中的分支

💡分支只是提交对象(COMMIT)的命名引用。 

我们可以一直用 SHA-1 哈希值引用一个 **提交**，但是人们通常喜欢以其他形式命名对象。**分支** 恰好是引用 **提交** 的一种方式，实际上也只是这样。

`git branch` 命令创建一个新分支， 实际上我们创建的是另一个指针(pointer)
![[Pasted image 20230327012923.png]]
`HEAD`是一个特殊指针，它指向当前所在的分支，分支指向一个提交。

`git`内部将**分支**成为**heads**，所以.git文件夹中会创建一个`./.git/ref/heads`的目录。

### 如何在Git中记录变化
通常我们在工作目录中编写源代码。 工作目录关联着一个仓库(repo)

在做了一些改动之后，我们会把这些改动记录到**仓库**中。一个**仓库**就是一系列**提交（COMMIT）** 的集合。每个 **提交** 都是工程 **工作树** 的归档。

**仓库**也包含除代码文件以外的其他东西，如`HEAD`指针、分支等等。

创建 blob 这个过程通常发生在我们将一些东西添加到 暂存区 的时候——也就是我们使用 git add 的时候。

记住：git 是为 整个 暂存的文件创建 blob。即使文件中只有修改或添加了一个字符（如同我们在之前的例子红添加 ! 一样），该文件也会有一个新的 blob，这个 blob 有着新的哈希值。

#### .git组成
一个 **仓库** 可能还包含一些其它的东西，比如 git 钩子（hooks）。不过，仓库至少必须要有对象和引用。

让我们分别为对象和引用（简称：**refs**）各创建一个目录，Windows 下的两个目录分别为 `.git\objects` 和 `.git\refs`（UNIX 下的两个目录分别为 `.git/objects` 和 `.git/refs`）。

**分支** 是引用的一种，`git` 内部将 **分支** 称为 **heads**，所以我们会为它们创建一个目录 `git\refs\heads`。

`HEAD`，它是一个位于 `.git\HEAD` 的文件。我们可以这么

- `.git/objects` git的对象数据库，里面存储着BLOB,TREE,COMMIT等对象
```
所以，`git` 实际上是使用 SHA-1 哈希值的前两个字符作为目录的名字，剩余字符用作 **blob** 所在文件的文件名

为什么要这样呢？考虑一个非常大的仓库，仓库的数据库内存有三十万个对象（blob 对象、树对象和提交对象）。从这三十万个哈希值中找出一个值会花些时间，因此，`git` 将这个问题划分成了 256 份。
```
- `.git/index`文件，这就是著名的**索引（或暂存区）**， 它基本上就是一个位于`.git/index`的文件。


### 参考
---
[Git 内部原理图解——对象、分支以及如何从零开始建仓库](https://www.freecodecamp.org/chinese/news/git-internals-objects-branches-create-repo/)
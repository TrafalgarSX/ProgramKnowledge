### 以太网下设备发送接受数据包的流程
---
#### 决定是否为同一局域网
第一步：pc1想要给pc2发送消息，**通过pc1的子网掩码与pc2的ip地址相与**

  1. 发现pc1与pc2不在同一网段，那么只能通过网关，所以pc1会发送ARP广播请求获取网关的mac地址，然后封装成数据帧发送给路由器AR1；（目标ip地址与源子网掩码相与判断是否再一个网段！）
  2. 发现pc1与pc2在同一网段，那么直接发送数据帧，(如果不知道pc2的MAC地址， pc1会发送ARP广播请求获取对方设备的mac地址)，然后封装成数据帧发送给 pc2；（目标ip地址与源子网掩码相与判断是否再一个网段！）
  
❗如果不是同一网段，才有以下步骤：

第二步：路由器AR1接收到数据帧会进行拆包，发现这个是给到pc2的数据包，查找路由表发现到pc2的网段接口是C，所以封装数据帧，从C转发给到路由器AR2;（拆包—查路由表—封装转发）

第三步：路由器AR2收到数据帧后再次进行拆包，发现这是给pc2的数据，查询路由表，可以直接通过接口E转发给pc2

如果是没有找到目标ip地址，那么会从默认路由转发，或者发送一个出错ICMP报文反馈给pc1，表明目标地址不可达（也就是TYPE 3,CODE 1）


[【网络层】详解路由器转发数据包过程-CSDN博客](https://blog.csdn.net/liu_xueyin/article/details/133887479?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-2-133887479-blog-103068738.235%5Ev39%5Epc_relevant_anti_t3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-2-133887479-blog-103068738.235%5Ev39%5Epc_relevant_anti_t3)

### Wifi下设备发送接受数据包的流程
---
Wifi比较特殊， 所有的数据帧都需要通过 AP 转发， （❓这可能是因为Wifi的介质和信号等问题， 设备之间很可能不能直接找到对方设备的原因？ TODO，需要 AP 才能保证设备之间的交互）

```chatgpt
在Wi-Fi网络中，电脑之间发送IP数据包的流程与有线以太网有些相似，但在物理传输和一些细节方面有所不同。以下是电脑之间通过Wi-Fi发送IP数据包的一般流程：

1. **数据包封装：** 发送端电脑将数据包进行封装，添加了数据链路层的头部和尾部，形成一个帧。这个帧包含目标电脑的MAC地址、源电脑的MAC地址、Wi-Fi网络类型以及数据。
    
2. **Wi-Fi连接和认证：** 发送端电脑通过Wi-Fi无线接口连接到Wi-Fi路由器或访问点，并进行认证（如果需要）。这一步通常包括身份验证和密钥交换，以确保发送端可以访问Wi-Fi网络。
    
3. **ARP和寻址：** 如果发送端知道目标电脑的IP地址但不知道其MAC地址，它会在Wi-Fi网络上发送一个ARP请求，类似于有线网络中的流程，以获取目标IP地址对应的MAC地址。
    
4. **发送数据包：** 发送端通过Wi-Fi接口将帧发送到Wi-Fi网络。数据包通过Wi-Fi路由器或访问点传输到Wi-Fi网络中的目标设备。
    
5. **Wi-Fi路由器处理：** Wi-Fi路由器或访问点负责接收Wi-Fi帧，并根据目标MAC地址将帧转发到相应的目标设备。
    
6. **接收端处理：** 目标设备接收到Wi-Fi帧后，会检查帧头部的目标MAC地址是否与自己的MAC地址匹配。如果匹配，它会解析帧，提取出IP数据包，并将数据包传递给网络层协议栈。
    
7. **IP层处理：** 接收端电脑的网络层会检查数据包的目标IP地址，验证是否是自己的地址。如果是，则将数据包传递给上层应用程序处理。
    

总体而言，Wi-Fi网络中的数据传输过程与有线以太网相似，但是使用了Wi-Fi协议进行无线传输，并依赖于Wi-Fi路由器或访问点来实现无线连接和数据的传输。
```